<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ë³´ì¹´ë„ - ìŒì„± ë³€í™˜ ì„œë¹„ìŠ¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        :root {
            --brand-yellow-light: #FFFBEB;
            --brand-green-dark: #166534;
            --brand-green-light: #36d654;
            --brand-green-hover: #15803d;
            --text-dark: #374151;
            --text-light: #6b7280;
            --border-color: #e5e7eb;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--brand-yellow-light);
            color: var(--text-dark);
            scroll-behavior: smooth;
        }
        .section { min-height: 100vh; }
        .section-1 { height: 100vh; position: relative; }
        .container { max-width: 1024px; margin: auto; }
        
        .icon { width: 35.28px; height: 35.28px; object-fit: contain; }
        @media (min-width: 768px) { .icon { width: 52.92px; height: 52.92px; } }
        
        .gradient-overlay {
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 200px;
            background: linear-gradient(to top, var(--brand-yellow-light), rgba(255, 251, 235, 0));
        }

        @keyframes slideInFromBottom {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .main-icon { animation: slideInFromBottom 1s ease-out; }

        #login-section, #signup-section, #main-app-section, #message-box, #loading-overlay, #email-modal, #mypage-section {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 251, 235, 0.9); z-index: 100;
        }
        #loading-overlay { background-color: rgba(255, 251, 235, 0.8); z-index: 110; }

        .form-box, .app-box {
            position: relative;
            margin: auto; background-color: white;
            border-radius: 1.5rem; border: 1px solid var(--border-color);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            padding: 2rem 3rem; width: 100%; max-width: 28rem; text-align: center;
        }
        .app-box { max-width: 42rem; padding: 2rem; }

        .message-box-content {
            background-color: white;
            padding: 2rem; border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            width: 90%; max-width: 400px; text-align: center;
        }
        
        #share-modal {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 105;
        }
        .share-option { @apply p-4 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer; }
        .instagram-gradient {
            background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
        }
        
        .password-container { position: relative; }
        .toggle-password {
            position: absolute;
            right: 1rem; top: 50%;
            transform: translateY(-50%); cursor: pointer; color: #d1d5db;
        }
        
        .tab-button {
            @apply flex items-center whitespace-nowrap py-4 px-1 border-b-2 font-semibold text-lg transition-colors duration-200 ease-in-out;
        }
        .tab-button:not(.active) {
            @apply border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700;
        }
        .tab-button.active {
            @apply border-[var(--brand-green-dark)] text-[var(--text-dark)];
        }
        
        .loader {
            border: 8px solid #f3f3f3;
            border-radius: 50%; border-top: 8px solid var(--brand-green-dark);
            width: 60px; height: 60px; animation: spin 2s linear infinite;
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        
        .voice-icon-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #f0f2f5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-dark);
            flex-shrink: 0;
        }

        .audio-control-btn {
            @apply w-12 h-12 rounded-full bg-white text-[var(--brand-green-dark)] flex items-center justify-center shadow-md transition-colors hover:bg-gray-100 flex-shrink-0 text-xl;
        }
        #progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px; height: 16px;
            background: var(--brand-green-dark);
            cursor: pointer; border-radius: 50%;
        }
        #progress-bar::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: var(--brand-green-dark);
            cursor: pointer; border-radius: 50%;
        }

        .mypage-menu-item {
            @apply flex items-center justify-between p-4 bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200 cursor-pointer;
        }
    </style>
</head>
<body class="overflow-x-hidden">
    <div class="section section-1 flex items-center justify-center text-center p-4 bg-gradient-to-br from-yellow-100 to-green-100" id="main-section">
        <div class="absolute top-8 left-8 flex items-center space-x-2 bg-white rounded-full shadow-lg px-4 py-2 z-10">
            <img src="https://i.postimg.cc/d1W6XT4w/x.png" alt="ì•„ë³´ì¹´ë„ ë¡œê³ " class="icon" onerror="this.onerror=null;this.src='https://placehold.co/52x52/A0D9B4/FFFFFF?text=A';">
            <span class="text-2xl font-extrabold text-[#113953]">AVOCADO</span>
        </div>
        <div class="flex flex-col items-center">
  
            <img src="https://i.postimg.cc/43QB60cK/image.png" alt="ì•„ë³´ì¹´ë„ ë©”ì¸ ì•„ì´ì½˜" class="mb-4 w-40 h-40 object-contain main-icon" onerror="this.onerror=null;this.src='https://placehold.co/160x160/A0D9B4/FFFFFF?text=AVOCADO';">
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-[#3E2723] mb-4 transition-transform duration-500 hover:scale-105">
                ì•„ë³´ì¹´ë„
            </h1>
            <p class="text-xl md:text-2xl font-semibold text-gray-600">
               
                 Ai Voice Commnication Development Tool
            </p>
            <div class="flex space-x-4 mt-8 z-20">
                <a id="scrollButton" href="#intro-section" class="bg-[var(--brand-green-dark)] text-white font-bold py-3 px-8 rounded-full shadow-lg transition-colors duration-300 hover:bg-[var(--brand-green-hover)] hover:shadow-xl">
                    ì†Œê°œ ë³´ê¸°
                </a>
 
                <a id="startButton" href="#" class="group bg-white text-[var(--brand-green-dark)] font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 hover:bg-gray-100 hover:shadow-xl flex items-center justify-center">
                    <span>ì‹œì‘í•˜ê¸°</span>
                    <i class="fa-solid fa-arrow-right w-0 opacity-0 group-hover:w-5 group-hover:opacity-100 group-hover:ml-2 transition-all duration-300 ease-in-out"></i>
                </a>
  
            </div>
        </div>
        <div class="gradient-overlay"></div>
    </div>

    <div class="section py-20 px-6" id="intro-section">
        <div class="container space-y-20">
            <div class="bg-white rounded-3xl shadow-xl p-8 md:p-12 transition-transform duration-500 hover:scale-105">
                <div class="flex items-center mb-4">
     
                    <i class="fas fa-seedling text-3xl text-[var(--brand-green-light)] mr-4"></i>
                    <h2 class="text-3xl md:text-4xl font-bold text-[var(--brand-green-dark)]">AVOCADO í”„ë¡œì íŠ¸ ê°œìš”</h2>
                </div>
                <p class="text-lg md:text-xl text-gray-700 leading-relaxed pl-11">
                 
                   ì €í¬ ì•„ë³´ì¹´ë„ëŠ” ë°œí™”ì— ì–´ë ¤ì›€ì„ ê²ªëŠ” ì‚¬ìš©ìë¥¼ ìœ„í•´ AI ê¸°ë°˜ í…ìŠ¤íŠ¸-ìŒì„± ë³€í™˜(TTS) ë° ì»¤ìŠ¤í…€ ìŒì„± ëª¨ë¸ ìƒì„± ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
                 ì‚¬ìš©ìê°€ ì…ë ¥í•œ í…ìŠ¤íŠ¸ë¥¼ ë‹¤ì–‘í•œ AI ìŒì„± ëª¨ë¸ë¡œ ë³€í™˜í•˜ê±°ë‚˜, ìì‹ ì˜ ëª©ì†Œë¦¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°œì¸í™”ëœ ìŒì„± ëª¨ë¸ì„ ì œì‘í•˜ì—¬ ìì—°ìŠ¤ëŸ¬ìš´ ì†Œí†µì„ ê°€ëŠ¥í•˜ê²Œ ë•ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.
                 </p>
            </div>
            <div class="bg-white rounded-3xl shadow-xl p-8 md:p-12 transition-transform duration-300 hover:translate-y-[-8px] hover:shadow-md">
                 <div class="flex items-center mb-4">
                    <i class="fas fa-comment-dots text-3xl text-[var(--brand-green-light)] mr-4"></i>
                    <h3 class="text-2xl 
                     font-semibold text-[var(--brand-green-dark)]">í…ìŠ¤íŠ¸-ìŒì„± ë³€í™˜ (TTS)</h3>
                </div>
                <p class="text-gray-600 pl-11">
                    í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ë©´ AI ìŒì„±ìœ¼ë¡œ ë³€í™˜í•´ ë“œë¦½ë‹ˆë‹¤.
                    ë‹¤ì–‘í•œ ê¸°ë³¸ ìŒì„± ëª¨ë¸ ì¤‘ì—ì„œ ì„ íƒí•  ìˆ˜ ìˆìœ¼ë©°, ë³€í™˜ëœ ìŒì„±ì€ ë°”ë¡œ ì¬ìƒ, ë‹¤ìš´ë¡œë“œ ë˜ëŠ” ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                 </p>
            </div>
            <div class="bg-white rounded-3xl shadow-xl p-8 md:p-12 transition-transform duration-300 hover:translate-y-[-8px] hover:shadow-md">
                <div class="flex items-center mb-4">
                    <i class="fas fa-microphone-alt text-3xl text-[var(--brand-green-light)] mr-4"></i>
                    <h3 class="text-2xl font-semibold 
                     text-[var(--brand-green-dark)]">ì»¤ìŠ¤í…€ ìŒì„± ëª¨ë¸ ì œì‘</h3>
                </div>
                <p class="text-gray-600 pl-11">
                    ì‚¬ìš©ìê°€ ì§ì ‘ ë…¹ìŒí•œ ìŒì„±ì„ ê¸°ë°˜ìœ¼ë¡œ ì„¸ìƒì— í•˜ë‚˜ë¿ì¸ 'ë‚˜ë§Œì˜ ëª©ì†Œë¦¬' ëª¨ë¸ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                 ë°œìŒì´ ë‹¤ì†Œ ë¶ˆë¶„ëª…í•´ë„ ìŒìƒ‰ê³¼ í†¤ì„ í•™ìŠµí•˜ì—¬ ê°œì¸í™”ëœ ëª©ì†Œë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                </p>
            </div>
                        <div class="bg-white rounded-3xl shadow-xl p-8 md:p-12 transition-transform duration-300 hover:translate-y-[-8px] hover:shadow-md">
                <div class="flex items-center mb-4">
                    <i class="fas fa-wrench text-3xl" style="color: #63E6BE;"></i>
  
                     <h3 class="text-2xl font-semibold text-[var(--brand-green-dark)]"> ì œì‘ì</h3>
                </div>
                <p class="text-gray-600 pl-11">
                    TEAM.
                 ê¹€ë³€ë‚˜
                </p>
            </div>
        </div>
    </div>
    
    <div id="login-section" class="flex items-center justify-center p-4">
        <div class="form-box">
            <a href="#" class="absolute top-4 left-4 text-3xl text-gray-400 hover:text-gray-600 transition-colors duration-200" id="login-back-button">&#x2190;</a>
         
           <h2 class="text-3xl font-bold mb-6 text-[var(--brand-green-dark)]">ë¡œê·¸ì¸</h2>
            <form class="space-y-4" id="login-form">
                <input type="email" id="login-email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)] transition-all duration-200" required>
                <div class="password-container">
                    <input type="password" id="login-password" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full px-4 py-3 rounded-xl border border-gray-300 
                     focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)] transition-all duration-200" required>
                    <span class="toggle-password" onclick="togglePasswordVisibility('login-password')"><i class="fa-solid fa-eye"></i></span>
                </div>
                <button type="submit" class="w-full bg-[var(--brand-green-dark)] text-white font-bold py-3 rounded-xl shadow-lg hover:bg-[var(--brand-green-hover)] transition-colors duration-300">ë¡œê·¸ì¸</button>
            </form>
            <p class="mt-4 text-sm text-gray-500">ê³„ì •ì´ 
             ì—†ìœ¼ì‹ ê°€ìš”? <a href="#" class="text-[var(--brand-green-dark)] hover:underline font-semibold" id="to-signup-button">íšŒì›ê°€ì…</a></p>
        </div>
    </div>

    <div id="signup-section" class="flex items-center justify-center p-4">
        <div class="form-box overflow-y-auto max-h-[90vh]">
            <a href="#" class="absolute top-4 left-4 text-3xl text-gray-400 hover:text-gray-600 transition-colors duration-200" id="signup-back-button">&#x2190;</a>
            <h2 class="text-3xl font-bold mb-6 text-[var(--brand-green-dark)]">íšŒì›ê°€ì…</h2>
            <form class="space-y-4" id="signup-form" novalidate>
  
                 <input type="text" id="signup-name" placeholder="ì´ë¦„" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)] transition-all duration-200" required>
                <input type="email" id="signup-email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)] transition-all duration-200" required>
                <div class="password-container">
                    <input type="password" 
                     id="signup-password" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)] transition-all duration-200" required>
                    <span class="toggle-password" onclick="togglePasswordVisibility('signup-password')"><i class="fa-solid fa-eye"></i></span>
                </div>
                <p id="password-validation-error" class="text-xs text-red-600 mt-1">ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•œ 10ìë¦¬ ì´ìƒ</p>
                <div class="password-container">
     
                    <input type="password" id="signup-password-confirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)] transition-all duration-200" required>
                    <span class="toggle-password" onclick="togglePasswordVisibility('signup-password-confirm')"><i class="fa-solid fa-eye"></i></span>
                </div>
                <p id="password-match-error" class="text-xs text-red-600 mt-1 hidden">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
      
                 <div class="text-left pt-2">
                    <label class="text-gray-600 font-semibold">ìƒë…„ì›”ì¼</label>
                    <div class="flex items-center gap-2 mt-1">
                        <input type="number" id="signup-year" placeholder="YYYY" class="w-1/3 px-4 py-3 rounded-xl border border-gray-300 text-center focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)]" required>
    
                         <input type="number" id="signup-month" placeholder="MM" class="w-1/3 px-4 py-3 rounded-xl border border-gray-300 text-center focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)]" required>
                        <input type="number" id="signup-day" placeholder="DD" class="w-1/3 px-4 py-3 rounded-xl border border-gray-300 text-center focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)]" required>
                    </div>
        
                     <input type="hidden" id="calculated-age">
                </div>
                <div class="flex flex-col items-start space-y-2">
                    <label class="text-gray-600 font-semibold">ì„±ë³„</label>
                    <div class="flex space-x-4">
      
                         <label class="inline-flex items-center"><input type="radio" name="gender" value="male" class="form-radio text-[var(--brand-green-dark)] focus:ring-[var(--brand-green-light)]" required><span class="ml-2 text-gray-700">ë‚¨ì„±</span></label>
                        <label class="inline-flex items-center"><input type="radio" name="gender" value="female" class="form-radio text-[var(--brand-green-dark)] focus:ring-[var(--brand-green-light)]"><span class="ml-2 text-gray-700">ì—¬ì„±</span></label>
                    </div>
                </div>
 
                 <button type="submit" id="signup-button" class="w-full bg-[var(--brand-green-dark)] text-white font-bold py-3 rounded-xl shadow-lg hover:bg-[var(--brand-green-hover)] transition-colors duration-300 !mt-6">íšŒì›ê°€ì…</button>
            </form>
        </div>
    </div>
    
    <div id="main-app-section" class="flex items-center justify-center p-4">
        <div class="app-box">
            <div class="flex justify-between items-center w-full mb-6">
 
                <a href="#" class="text-3xl text-gray-400 hover:text-gray-600 transition-colors duration-200" id="app-back-button">&#x2190;</a>
                <div class="flex items-center space-x-4">
                    <a href="#" id="mypage-button" class="flex items-center space-x-2">
                        <img id="header-profile-image" src="https://i.postimg.cc/tyhHrhkC/image.png" alt="í”„ë¡œí•„ ì‚¬ì§„" class="w-8 h-8 rounded-full object-cover">
  
                         <span class="text-sm text-gray-500 hover:underline">ë§ˆì´í˜ì´ì§€</span>
                    </a>
                    <a href="#" class="text-sm text-gray-500 hover:underline" id="logout-button-from-app">ë¡œê·¸ì•„ì›ƒ</a>
                </div>
            </div>
  
             <div class="border-b border-gray-200">
                <div class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tts-tab" class="tab-button active">
                        <i class="fas fa-comment-dots mr-2"></i>
                  
             <span>TTS</span>
                    </button>
                    <button id="my-voice-tab" class="tab-button">
                        <i class="fas fa-microphone-alt mr-2"></i>
                        <span>ë‚˜ë§Œì˜ 
                         ëª©ì†Œë¦¬ ëª¨ë¸</span>
                    </button>
                </div>
            </div>
            
            <div id="tts-content" class="w-full pt-6">
        
                 <form class="space-y-4 text-left" id="tts-form">
                    <div class="flex flex-col space-y-2">
                        <label for="tts-text" class="text-lg font-semibold text-gray-700">ë³€í™˜í•  í…ìŠ¤íŠ¸</label>
                        <textarea id="tts-text" rows="6" placeholder="ì—¬ê¸°ì— ë³€í™˜í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." class="w-full p-4 rounded-xl border border-gray-300 focus:outline-none 
                         focus:ring-2 focus:ring-[var(--brand-green-light)] transition-all duration-200" required></textarea>
                    </div>
                    <div class="flex flex-col space-y-3">
                        <label for="voice-select" class="text-lg font-semibold text-gray-700">ìŒì„± ëª¨ë¸ ì„ íƒ</label>
                       
                 <div class="relative" id="custom-select-container">
                            <div id="custom-select-trigger" class="w-full px-4 py-2 rounded-xl border border-gray-300 bg-white cursor-pointer flex items-center justify-between">
                                </div>
                            <div id="custom-select-options" class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-xl shadow-lg hidden">
                                </div>
                        </div>
                        <input type="hidden" id="selected-voice" value="">
                    </div>
          
                     <button type="submit" id="convert-button" class="w-full bg-[var(--brand-green-dark)] text-white font-bold py-3 rounded-xl shadow-lg hover:bg-[var(--brand-green-hover)] transition-colors duration-300 !pt-4">
                        <i class="fas fa-magic-wand-sparkles mr-2"></i> ìŒì„±ìœ¼ë¡œ ë³€í™˜í•˜ê¸°
                    </button>
                </form>
            
             <div id="tts-result" class="mt-8 p-6 bg-gray-50 rounded-xl hidden">
                    <p class="text-lg font-semibold text-gray-700 mb-4">ë³€í™˜ ê²°ê³¼</p>
                    <div class="flex items-center justify-between gap-4">
                        <div id="custom-audio-player" class="flex items-center gap-3 w-full">
            
                             <button id="play-pause-btn" class="audio-control-btn">
                                <i class="fa-solid fa-play"></i>
                            </button>
                    
                     <span id="current-time" class="text-sm text-gray-500 font-mono">00:00</span>
                            <input type="range" id="progress-bar" value="0" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                             <span id="total-time" class="text-sm text-gray-500 font-mono">00:00</span>
                 
                        </div>
                        <audio id="tts-audio" class="hidden"></audio>
                        <div id="download-container" class="relative" style="display:none;">
                          <button id="download-toggle-button" class="audio-control-btn">
                            <i class="fa-solid fa-download"></i>
                          </button>
                          <div id="download-options" class="hidden absolute bottom-full mb-2 right-0 bg-white rounded-lg shadow-lg border w-40 z-20">
                            <a id="download-wav" href="#" download="avocado_tts.wav" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">WAV í˜•ì‹</a>
                            <a id="download-mp3" href="#" download="avocado_tts.mp3" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">MP3 í˜•ì‹</a>
                          </div></div></div>
                    <button id="share-button" class="mt-4 w-full bg-[var(--brand-green-dark)] text-white font-bold py-2 rounded-xl shadow-lg hover:bg-[var(--brand-green-hover)] transition-colors duration-300 hidden">
                      <i class="fa-solid fa-share-alt mr-2"></i> ê³µìœ í•˜ê¸°</button></div>
            </div>

            <div id="my-voice-content" class="w-full pt-6 hidden">
          
               <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                    <div class="flex">
                        <div class="flex-shrink-0">
                        
                             <i class="fas fa-info-circle text-blue-500 text-xl"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-bold text-blue-800">ì»¤ìŠ¤í…€ ìŒì„± ëª¨ë¸ ë§Œë“¤ê¸°</h3>
         
                             <p class="text-sm text-blue-700 mt-1">
                                ë‹¹ì‹ ë§Œì˜ ëª©ì†Œë¦¬ë¡œ AI ìŒì„± ëª¨ë¸ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.
                                 <strong>ìµœëŒ€ 3ê°œ</strong>ê¹Œì§€ ìƒì„± ê°€ëŠ¥í•©ë‹ˆë‹¤.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between items-center mb-6 p-4 bg-gray-50 rounded-xl">
                    <span class="text-gray-700 font-semibold">ë‚´ ì»¤ìŠ¤í…€ ëª¨ë¸</span>
                    <span id="model-count-badge" class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-bold">
                        0 / 3
               
                     </span>
                </div>

                <div id="my-models-list" class="space-y-3 mb-6">
                    </div>

                <div id="create-model-form" class="space-y-4">
                    <form id="custom-voice-upload-form">
                        <div class="space-y-4">
             
                             <div>
                                <label for="model-name-input" class="block text-sm font-semibold text-gray-700 mb-2">
               
                                     ëª¨ë¸ ì´ë¦„ <span class="text-red-500">*</span>
                                </label>
                                <input 
           
                                     type="text" 
                                    id="model-name-input" 
                                    placeholder="ì˜ˆ: 
                                     ë‚´ ëª©ì†Œë¦¬, ì—„ë§ˆ ëª©ì†Œë¦¬" 
                                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)]"
                                    maxlength="20"
                
                                     required
                                >
                                <p class="text-xs text-gray-500 mt-1">ìµœëŒ€ 20ì</p>
            
                             </div>

                            <div>
                        
                         <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    ìŒì„± íŒŒì¼ ì—…ë¡œë“œ <span class="text-red-500">*</span>
                                </label>
               
                                 <div class="flex items-center gap-3">
                                    <label for="voice-file-input" class="flex-1 cursor-pointer">
                                        <div 
                                         class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-[var(--brand-green-light)] transition-colors">
                                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                                            
                                             <p class="text-sm text-gray-600">
                                                <span class="font-semibold text-[var(--brand-green-dark)]">í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ</span>
                                              
                                                 ë˜ëŠ” ë“œë˜ê·¸ ì•¤ ë“œë¡­
                                            </p>
                                            <p class="text-xs text-gray-500 mt-1">WAV ë˜ëŠ” MP3 (ìµœëŒ€ 
                                             50MB)</p>
                                        </div>
                                    </label>
                        
                             <input 
                                        type="file" 
                                        id="voice-file-input" 
     
                                        accept=".wav,.mp3,audio/wav,audio/mpeg" 
                                        class="hidden"
                        
                                         required
                                    >
                                </div>
                
                                 <p id="file-name-display" class="text-sm text-gray-600 mt-2 hidden"></p>
                            </div>

                            <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
                                <h4 class="font-semibold text-yellow-800 mb-2 flex items-center">
                                    <i class="fas fa-lightbulb mr-2"></i>
            
                                     ë…¹ìŒ íŒ
                                </h4>
                                <ul class="text-xs text-yellow-700 space-y-1 list-disc list-inside">
      
                                     <li>ì¡°ìš©í•œ í™˜ê²½ì—ì„œ ë…¹ìŒí•´ì£¼ì„¸ìš”</li>
                                    <li>ìµœì†Œ 1ë¶„ ì´ìƒì˜ ìŒì„±ì´ í•„ìš”í•©ë‹ˆë‹¤</li>
                            
                                     <li>ìì—°ìŠ¤ëŸ½ê²Œ ë§ì”€í•´ì£¼ì„¸ìš” (ë°œìŒì´ ë¶ˆì™„ì „í•´ë„ ê´œì°®ìŠµë‹ˆë‹¤)</li>
                                    <li>ë‹¤ì–‘í•œ ë¬¸ì¥ì„ ì½ìœ¼ë©´ ë” ì¢‹ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                                </ul>
            
                                 </div>

                            <button 
                        
                         type="submit" 
                                id="upload-voice-button"
                                class="w-full bg-[var(--brand-green-dark)] text-white font-bold py-3 rounded-xl shadow-lg hover:bg-[var(--brand-green-hover)] transition-colors duration-300"
                  
                           >
                                <i class="fa-solid fa-plus mr-2"></i> ì»¤ìŠ¤í…€ ëª¨ë¸ ìƒì„±í•˜ê¸°
                            </button>
                        
                         </div>
                    </form>
                </div>

                <div id="model-limit-message" class="hidden text-center p-6 bg-gray-50 rounded-xl">
                  
                   <i class="fas fa-exclamation-circle text-4xl text-gray-400 mb-3"></i>
                    <p class="text-gray-600 font-semibold">ìµœëŒ€ 3ê°œì˜ ëª¨ë¸ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.</p>
                    <p class="text-sm text-gray-500 mt-2">ê¸°ì¡´ ëª¨ë¸ì„ ì‚­ì œí•˜ë©´ ìƒˆë¡œìš´ ëª¨ë¸ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
  
     </div>
    
    <div id="mypage-section" class="flex items-center justify-center p-4">
        <div class="form-box !max-w-xl text-left">
            <a href="#" class="absolute top-4 left-4 text-3xl text-gray-400 hover:text-gray-600" id="mypage-back-button">&#x2190;</a>
            <h2 class="text-3xl font-bold mb-6 text-[var(--brand-green-dark)] text-center">ë§ˆì´í˜ì´ì§€</h2>

            <div 
             class="flex flex-col items-center mb-6">
                <div class="relative w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center cursor-pointer group hover:bg-gray-300 transition-colors" id="profile-pic-container">
                    <img id="profile-image" src="https://placehold.co/128x128/D1D5DB/FFFFFF?text=PROFILE" alt="í”„ë¡œí•„ ì‚¬ì§„" class="w-full h-full rounded-full object-cover">
                    <div class="absolute inset-0 flex items-center justify-center rounded-full bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
        
                         <i class="fas fa-camera text-white text-3xl"></i>
                    </div>
                </div>
                <input type="file" id="profile-pic-input" accept="image/*" class="hidden">
            </div>
            
            
            <div id="mypage-menu">
                <p class="text-center text-gray-600 mb-8" id="mypage-greeting"></p>
                <div class="flex flex-col space-y-4">
                    <div id="change-info-button" class="mypage-menu-item">
         
                         <span class="text-lg font-semibold text-[var(--text-dark)] flex items-center">
                            <i class="fas fa-user-edit text-[var(--brand-green-dark)] mr-3 text-xl"></i>
                            ë‚´ ì •ë³´ ë³€ê²½
                 
                        </span>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </div>
                    <div id="history-button" class="mypage-menu-item">
                        
                         <span class="text-lg font-semibold text-[var(--text-dark)] flex items-center">
                            <i class="fas fa-history text-[var(--brand-green-dark)] mr-3 text-xl"></i>
                            ë³€í™˜ ê¸°ë¡ í™•ì¸
                        </span>
        
                         <i class="fas fa-chevron-right text-gray-400"></i>
                    </div>
                    <div id="settings-button" class="mypage-menu-item">
                        <span class="text-lg font-semibold text-[var(--text-dark)] flex items-center">
          
                             <i class="fas fa-cog text-[var(--brand-green-dark)] mr-3 text-xl"></i>
                            í™˜ê²½ì„¤ì •
                        </span>
                        <i 
                         class="fas fa-chevron-right text-gray-400"></i>
                    </div>
                </div>
            </div>

            <div id="change-info-section" class="hidden">
                <a href="#" class="text-3xl text-gray-400 
                 hover:text-gray-600 mb-4 inline-block" id="change-info-back-button">&#x2190;</a>
                <h3 class="text-2xl font-bold mb-6 text-[var(--brand-green-dark)] text-center">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
                <form class="space-y-4 text-left" id="password-reset-form">
                    <div id="email-verification-step">
          
                         <label for="current-email" class="font-semibold text-gray-700">ì´ë©”ì¼ í™•ì¸</label>
                        <p class="text-sm text-gray-500 mb-2">íšŒì›ê°€ì… ì‹œ ì‚¬ìš©í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ê³  ì¸ì¦ ì½”ë“œë¥¼ ë°›ìœ¼ì„¸ìš”.</p>
                        <div class="flex items-center gap-2">
                    
                         <input type="email" id="current-email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)]" required>
                            <button type="button" id="send-code-button" class="bg-[var(--brand-green-dark)] text-white font-bold py-3 px-4 rounded-xl hover:bg-[var(--brand-green-hover)] transition-colors whitespace-nowrap">ì¸ì¦</button>
                        </div>
               
                     </div>
                    
                    <fieldset id="reset-password-step" class="space-y-4 pt-4" disabled>
                        
                         <div>
                            <label for="verification-code" class="font-semibold text-gray-700">ì¸ì¦ì½”ë“œ</label>
                            <input type="text" id="verification-code" placeholder="ì´ë©”ì¼ë¡œ ë°›ì€ ì¸ì¦ì½”ë“œ" class="w-full mt-1 px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)]">
                        </div>
  
                         <div>
                            <label for="new-password" class="font-semibold text-gray-700">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                            <div class="password-container mt-1">
                
                                 <input type="password" id="new-password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)]">
                                <span class="toggle-password" onclick="togglePasswordVisibility('new-password')"><i class="fa-solid fa-eye"></i></span>
                            </div>
       
                             <p id="new-password-validation-error" class="text-xs text-red-600 mt-1">ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•œ 10ìë¦¬ ì´ìƒ</p>
                        </div>
                        <div>
                      
                         <label for="new-password-confirm" class="font-semibold text-gray-700">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                            <div class="password-container mt-1">
                                <input type="password" id="new-password-confirm" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)]">
             
                                 <span class="toggle-password" onclick="togglePasswordVisibility('new-password-confirm')"><i class="fa-solid fa-eye"></i></span>
                            </div>
                            <p id="new-password-match-error" class="text-xs text-red-600 mt-1 hidden">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
              
                         </div>
                    </fieldset>
        
                    <button type="submit" id="change-password-button" class="w-full bg-gray-300 text-white font-bold py-3 rounded-xl shadow-lg !mt-6 transition-colors" disabled>
                        ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
     
                     </button>
                </form>
            </div>

            <div id="conversion-history-section" class="hidden">
                <a href="#" class="text-3xl text-gray-400 hover:text-gray-600 mb-4 inline-block" id="history-back-button">&#x2190;</a>
    
                 <h3 class="text-2xl font-bold mb-6 text-[var(--brand-green-dark)] text-center">ë³€í™˜ ê¸°ë¡ í™•ì¸</h3>
                <div class="text-center text-gray-500 p-8 border border-gray-200 rounded-xl">
                    <i class="fas fa-list-ul text-4xl mb-4 text-[var(--brand-green-light)]"></i>
                    <p>ì•„ì§ ë³€í™˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
           
                 </div>
            </div>

            <div id="settings-section" class="hidden">
                <a href="#" class="text-3xl text-gray-400 hover:text-gray-600 mb-4 inline-block" id="settings-back-button">&#x2190;</a>
                <h3 class="text-2xl font-bold mb-6 text-[var(--brand-green-dark)] text-center">í™˜ê²½ì„¤ì •</h3>
          
                 <div class="text-center text-gray-500 p-8 border border-gray-200 rounded-xl">
                    <i class="fas fa-cogs text-4xl mb-4 text-[var(--brand-green-light)]"></i>
                    <p>ì•„ì§ ì„¤ì •í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    
     </div>

    <div id="message-box" class="flex justify-center items-center p-4">
        <div class="message-box-content">
            <p id="message-text" class="text-lg font-semibold text-gray-800 mb-4"></p>
            <button id="message-ok-button" class="bg-[var(--brand-green-dark)] text-white font-bold py-2 px-6 rounded-full hover:bg-[var(--brand-green-hover)] transition-colors duration-300">í™•ì¸</button>
        </div>
    </div>
    
    <div id="share-modal" class="p-4">
      <div class="bg-white rounded-xl shadow-xl p-6 text-left w-full max-w-xs sm:max-w-sm">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-2xl font-bold text-[var(--brand-green-dark)]">ê³µìœ í•˜ê¸°</h3>
          <button id="share-modal-close" class="text-3xl text-gray-400 hover:text-gray-600 leading-none">&times;</button>
        </div>
        <p class="text-gray-600 mb-6">ì•„ë˜ ì•±ìœ¼ë¡œ ê³µìœ í•˜ê±°ë‚˜ ì´ë©”ì¼ë¡œ íŒŒì¼ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <div class="grid grid-cols-3 gap-4 text-center">
          <div class="share-option" data-platform="instagram">
            <i class="fab fa-instagram text-4xl instagram-gradient"></i>
            <span class="mt-2 block text-sm font-medium">Instagram</span>
          </div>
          <div class="share-option" data-platform="kakao">
            <i class="fas fa-comment text-4xl text-[#FEE500]"></i>
            <span class="mt-2 block text-sm font-medium">ì¹´ì¹´ì˜¤í†¡</span>
          </div>
          <div class="share-option" data-platform="email">
            <i class="fas fa-envelope text-4xl text-gray-500"></i>
            <span class="mt-2 block text-sm font-medium">ì´ë©”ì¼</span>
          </div>
        </div>
      </div></div><div id="email-modal" class="p-4">
      <div class="bg-white rounded-xl shadow-xl p-6 text-left w-full max-w-md">
        <h3 class="text-2xl font-bold text-[var(--brand-green-dark)] mb-4">ì´ë©”ì¼ë¡œ ë³´ë‚´ê¸°</h3>
        <p class="text-gray-600 mb-6">ìŒì„± íŒŒì¼ì„ ë°›ì„ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
        <form id="email-modal-form">
          <input type="email" id="email-modal-input" placeholder="ì´ë©”ì¼ ì£¼ì†Œ"
                 class="w-full px-4 py-3 mb-4 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--brand-green-light)]" required>
          <div class="flex justify-end space-x-2">
            <button type="button" id="email-modal-cancel" class="bg-gray-200 text-gray-700 font-bold py-2 px-6 rounded-full hover:bg-gray-300">ì·¨ì†Œ</button>
            <button type="submit" class="bg-[var(--brand-green-dark)] text-white font-bold py-2 px-6 rounded-full hover:bg-[var(--brand-green-hover)]">ì „ì†¡</button>
          </div>
        </form>
      </div></div><div id="loading-overlay" class="flex justify-center items-center">
        <div class="loader"></div>
    </div>
    
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.1/kakao.min.js"
      integrity="sha384-dPuE23cCAMFN/lDCSavobjOaOhbGSfOhKTGN3dbaSchle7wo/wDr/kP1M2rGoRdo"
      crossorigin="anonymous"></script><script>
        // --- UI Elements ---
        const loadingOverlay = document.getElementById('loading-overlay');
        const allSections = document.querySelectorAll('.section, #login-section, #signup-section, #main-app-section, #mypage-section');
        const mypageSections = ['mypage-menu', 'change-info-section', 'conversion-history-section', 'settings-section'];
        // --- Event Listeners and App Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            // ========================= [ê³µìœ í•˜ê¸°] Kakao ì´ˆê¸°í™” ì‹œì‘ =========================
            try {
              if (Kakao) {
                Kakao.init('6cbf049eca3cbb41680e6053882d247d'); 
              }
            } catch(e) {
              console.error("Kakao SDK ì´ˆê¸°í™” ì˜¤ë¥˜. ì¹´ì¹´ì˜¤í†¡ ê³µìœ ê°€ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", e);
            }// ========================= [ê³µìœ í•˜ê¸°] Kakao ì´ˆê¸°í™” ë =========================
            
            showSection('main-section', 'flex');
            populateVoices();

        
            // ========================= [ê³µìœ í•˜ê¸°] ë²„íŠ¼/ëª¨ë‹¬ ë™ì‘ ì‹œì‘ =========================
            const shareModal = document.getElementById('share-modal');
            const shareModalClose = document.getElementById('share-modal-close');
            const shareOptions = document.querySelectorAll('.share-option');
            const emailModal = document.getElementById('email-modal');
            const emailModalForm = document.getElementById('email-modal-form');
            const emailModalInput = document.getElementById('email-modal-input');
            const emailModalCancel = document.getElementById('email-modal-cancel');

            document.getElementById('share-button').addEventListener('click', () => {
            Â  shareModal.style.display = 'flex';
            });

            shareModalClose.addEventListener('click', () => { shareModal.style.display = 'none'; });
            shareModal.addEventListener('click', (e) => { if (e.target === shareModal) shareModal.style.display = 'none'; });

            shareOptions.forEach(option => {
            Â  option.addEventListener('click', () => {
            Â  Â  const platform = option.dataset.platform;
            Â  Â  const textToShare = document.getElementById('tts-text').value;
            Â  Â  shareModal.style.display = 'none';

            Â  Â  switch (platform) {
            Â  Â  Â  case 'instagram':
            Â  Â  Â  Â  showMessage('ì¸ìŠ¤íƒ€ê·¸ë¨ DM ê³µìœ ëŠ” ëª¨ë°”ì¼ì˜ ê³µìœ í•˜ê¸° ê¸°ëŠ¥ì„ ì´ìš©í•´ì£¼ì„¸ìš”.');
            Â  Â  Â  Â  break;
            Â  Â  Â  case 'kakao':
            Â  Â  Â  Â  if (Kakao && Kakao.isInitialized()) {
            Â  Â  Â  Â  Â  Kakao.Share.sendDefault({
            Â  Â  Â  Â  Â  Â  objectType: 'text',
            Â  Â  Â  Â  Â  Â  text: `ì•„ë³´ì¹´ë„ì—ì„œ ìƒì„±ëœ ìŒì„± ë©”ì‹œì§€ì…ë‹ˆë‹¤ ğŸ¥‘\n\n"${textToShare}"`,
            Â  Â  Â  Â  Â  Â  link: {
            Â  Â  Â  Â  Â  Â  Â  mobileWebUrl: window.location.href,
            Â  Â  Â  Â  Â  Â  Â  webUrl: window.location.href,
            Â  Â  Â  Â  Â  Â  },
            Â  Â  Â  Â  Â  Â  buttons: [{
            Â  Â  Â  Â  Â  Â  Â  title: 'ì•„ë³´ì¹´ë„ì—ì„œ ì§ì ‘ ë“¤ì–´ë³´ê¸°',
            Â  Â  Â  Â  Â  Â  Â  link: { mobileWebUrl: window.location.href, webUrl: window.location.href }
            Â  Â  Â  Â  Â  Â  }]
            Â  Â  Â  Â  Â  });
            Â  Â  Â  Â  } else {
            Â  Â  Â  Â  Â  showMessage('ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ê¸°ëŠ¥ì„ ì´ˆê¸°í™”í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
            Â  Â  Â  Â  }
            Â  Â  Â  Â  break;
            Â  Â  Â  case 'email':
            Â  Â  Â  Â  emailModalInput.value = localStorage.getItem('loggedInUser') || '';
            Â  Â  Â  Â  emailModal.style.display = 'flex';
            Â  Â  Â  Â  break;
            Â  Â  }
            Â  });
            });
            // ========================= [ê³µìœ í•˜ê¸°] ë²„íŠ¼/ëª¨ë‹¬ ë™ì‘ ë =========================

            let currentWavBlob = null;
            // --- Custom Audio Player Logic ---
            const ttsAudioEl = document.getElementById('tts-audio');
            const playPauseBtn = document.getElementById('play-pause-btn');
            const playPauseIcon = playPauseBtn.querySelector('i');
            const progressBar = document.getElementById('progress-bar');
            const currentTimeEl = document.getElementById('current-time');
            const totalTimeEl = document.getElementById('total-time');
            function formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }

            playPauseBtn.addEventListener('click', () => {
                if (ttsAudioEl.paused) {
                    ttsAudioEl.play();
                } else {
                    ttsAudioEl.pause();
         
                }
            });
            ttsAudioEl.addEventListener('play', () => {
                playPauseIcon.classList.replace('fa-play', 'fa-pause');
            });
            ttsAudioEl.addEventListener('pause', () => {
                playPauseIcon.classList.replace('fa-pause', 'fa-play');
            });
            ttsAudioEl.addEventListener('loadedmetadata', () => {
                totalTimeEl.textContent = formatTime(ttsAudioEl.duration);
                progressBar.max = ttsAudioEl.duration;
            });
            ttsAudioEl.addEventListener('timeupdate', () => {
                progressBar.value = ttsAudioEl.currentTime;
                currentTimeEl.textContent = formatTime(ttsAudioEl.currentTime);
            });
            ttsAudioEl.addEventListener('ended', () => {
                progressBar.value = 0;
                currentTimeEl.textContent = formatTime(0);
                playPauseIcon.classList.replace('fa-pause', 'fa-play');
            });
            progressBar.addEventListener('input', () => {
                ttsAudioEl.currentTime = progressBar.value;
            });
            // ========================= [ê³µìœ í•˜ê¸°-ê´€ë ¨] ë‹¤ìš´ë¡œë“œ í† ê¸€ ì‹œì‘ =========================
            const downloadContainer = document.getElementById('download-container');
            const downloadToggleButton = document.getElementById('download-toggle-button');
            const downloadOptions = document.getElementById('download-options');
            const downloadWav = document.getElementById('download-wav');
            const downloadMp3 = document.getElementById('download-mp3');

            downloadToggleButton.addEventListener('click', (e) => {
            Â  e.stopPropagation();
            Â  downloadOptions.classList.toggle('hidden');
            });

            document.addEventListener('click', (e) => {
            Â  if (!downloadContainer.contains(e.target)) {
            Â  Â  downloadOptions.classList.add('hidden');
            Â  }
            });

            [downloadWav, downloadMp3].forEach(link => {
            Â  link.addEventListener('click', () => {
            Â  Â  downloadOptions.classList.add('hidden');
            Â  });
            });
            // ========================= [ê³µìœ í•˜ê¸°-ê´€ë ¨] ë‹¤ìš´ë¡œë“œ í† ê¸€ ë =========================
            // --- UI Control Functions ---
            function showLoading() { loadingOverlay.style.display = 'flex'; }
            function hideLoading() { loadingOverlay.style.display = 'none'; }
            function showMessage(message) {
                document.getElementById('message-text').textContent = message;
                document.getElementById('message-box').style.display = 'flex';
            }
            function hideMessage() { document.getElementById('message-box').style.display = 'none'; }
            
            function showSection(id, displayStyle = 'block') {
                allSections.forEach(el => el.style.display = 'none');
                const section = document.getElementById(id);
                if (section) section.style.display = displayStyle;
                if (id === 'main-section') {
                    document.getElementById('intro-section').style.display = 'block';
                }
            }

            function showMypageSubSection(id) {
                mypageSections.forEach(subId => document.getElementById(subId).classList.add('hidden'));
                document.getElementById(id).classList.remove('hidden');
            }
            
            function showTab(tabId) {
                ['tts-content', 'my-voice-content'].forEach(id => document.getElementById(id).classList.add('hidden'));
                document.getElementById(tabId).classList.remove('hidden');

                ['tts-tab', 'my-voice-tab'].forEach(id => document.getElementById(id).classList.remove('active'));
                const activeTabButtonId = tabId.replace('-content', '-tab');
                document.getElementById(activeTabButtonId).classList.add('active');
            }

            window.togglePasswordVisibility = function(id) {
                const passwordInput = document.getElementById(id);
                const toggleIcon = passwordInput.nextElementSibling.querySelector('i');
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    toggleIcon.classList.replace('fa-eye', 'fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    toggleIcon.classList.replace('fa-eye-slash', 'fa-eye');
                }
            }

            async function populateVoices() {
                const token = localStorage.getItem('token');
                const baseVoices = [
                    { id: 'default_male', icon: 'fa-solid fa-person', name: 'ë‚¨ì„±' },
                    { id: 'default_female', icon: 'fa-solid fa-person-dress', name: 'ì—¬ì„±' },
                    { id: 'default_character', icon: 'fa-solid fa-robot', name: 'ìºë¦­í„°' },
             
                   ];
                
                let allVoices = [...baseVoices];
                
                // ë¡œê·¸ì¸í•œ ê²½ìš° ì»¤ìŠ¤í…€ ëª¨ë¸ ë¶ˆëŸ¬ì˜¤ê¸°
                if (token) {
                    try {
                        const response = await fetch('http://localhost:3001/api/models/my-models', {
                   
                         headers: { 'Authorization': `Bearer ${token}` }
                        });
                        if (response.ok) {
                            const data = await response.json();
                            const customVoices = data.models.map(model => ({
                                id: String(model.id),
                                icon: 'fa-solid fa-user',
                            
                                 name: `${model.name} (ë‚´ ëª©ì†Œë¦¬)`,
                                isCustom: true
                            }));
                            allVoices = [...baseVoices, ...customVoices];
                        }
                    } catch (error) {
                        console.error('ì»¤ìŠ¤í…€ ëª¨ë¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                    }
                }
                
                // UI ìƒì„±
                const container = document.getElementById('custom-select-container');
                const trigger = document.getElementById('custom-select-trigger');
                const optionsContainer = document.getElementById('custom-select-options');
                const selectedVoiceInput = document.getElementById('selected-voice');

                optionsContainer.innerHTML = '';
                const createOptionHTML = (voice) => `
                    <div class="flex items-center">
                        <div class="voice-icon-circle ${voice.isCustom ? 'bg-green-100' : ''}">
                            <i class="${voice.icon} ${voice.isCustom ? 'text-green-700' : ''}"></i>
         
                         </div>
                        <span class="ml-3 font-semibold ${voice.isCustom ? 'text-green-800' : ''}">${voice.name}</span>
                    </div>`;
                allVoices.forEach((voice, index) => {
                    const optionElement = document.createElement('div');
                    optionElement.classList.add('p-3', 'cursor-pointer', 'hover:bg-gray-100', 'transition-colors');
                    optionElement.dataset.value = voice.id;
                    optionElement.innerHTML = createOptionHTML(voice);
       
                  
                    optionElement.addEventListener('click', () => {
                        selectedVoiceInput.value = voice.id;
                        trigger.innerHTML = createOptionHTML(voice) + `<i class="fa-solid fa-chevron-down text-gray-500"></i>`;
       
                         optionsContainer.classList.add('hidden');
                    });

                    optionsContainer.appendChild(optionElement);

                    if (index === 0) {
                   
                         selectedVoiceInput.value = voice.id;
                        trigger.innerHTML = createOptionHTML(voice) + `<i class="fa-solid fa-chevron-down text-gray-500"></i>`;
                    }
                });
                trigger.addEventListener('click', (e) => {
                    e.stopPropagation();
                    optionsContainer.classList.toggle('hidden');
                });
                document.addEventListener('click', (e) => {
                    if (!container.contains(e.target)) {
                        optionsContainer.classList.add('hidden');
                    }
                });
            }

            // --- Page Navigation ---
            document.getElementById('scrollButton').addEventListener('click', e => { e.preventDefault(); document.getElementById('intro-section').scrollIntoView({ behavior: 'smooth' }); });
            document.getElementById('startButton').addEventListener('click', e => {
                e.preventDefault();
                localStorage.getItem('loggedInUser') ? showSection('main-app-section', 'flex') : showSection('login-section', 'flex');
                showTab('tts-content');
            });
            document.getElementById('login-back-button').addEventListener('click', e => { e.preventDefault(); showSection('main-section', 'flex'); });
            document.getElementById('signup-back-button').addEventListener('click', e => { e.preventDefault(); showSection('login-section', 'flex'); });
            document.getElementById('to-signup-button').addEventListener('click', e => { e.preventDefault(); showSection('signup-section', 'flex'); });
            document.getElementById('app-back-button').addEventListener('click', e => { e.preventDefault(); showSection('main-section', 'flex'); });
            document.getElementById('message-ok-button').addEventListener('click', hideMessage);
            document.getElementById('logout-button-from-app').addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('loggedInUser');
                showMessage('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
                setTimeout(() => showSection('main-section', 'flex'), 1000);
            });
            document.getElementById('tts-tab').addEventListener('click', () => showTab('tts-content'));
            document.getElementById('my-voice-tab').addEventListener('click', () => showTab('my-voice-content'));
            
            // --- My Page Navigation ---
            document.getElementById('mypage-button').addEventListener('click', e => {
                e.preventDefault();
                const loggedInEmail = localStorage.getItem('loggedInUser');
                const users = JSON.parse(localStorage.getItem('users')) || {};
                
                const user = users[loggedInEmail];
                if (user) {
                    document.getElementById('mypage-greeting').textContent = `ì•ˆë…•í•˜ì„¸ìš”, ${user.name}ë‹˜ (${user.email})`;
                }
                showSection('mypage-section', 'flex');
                showMypageSubSection('mypage-menu');
      
              });

            document.getElementById('change-info-button').addEventListener('click', e => {
                e.preventDefault();
                showMypageSubSection('change-info-section');
            });
            document.getElementById('history-button').addEventListener('click', async (e) => {
                e.preventDefault();
                showMypageSubSection('conversion-history-section');
                
                const historyContainer = document.getElementById('conversion-history-section');
                const token = localStorage.getItem('token');

          
                     if (!token) {
                    historyContainer.innerHTML = '<p>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>';
                    return;
                }

                // ë¡œë”© ì¤‘ í‘œì‹œ
              
                 historyContainer.innerHTML = `
                    <a href="#" class="text-3xl text-gray-400 hover:text-gray-600 mb-4 inline-block" onclick="showMypageSubSection('mypage-menu'); return false;">&#x2190;</a>
                    <h3 class="text-2xl font-bold mb-6 text-[var(--brand-green-dark)] text-center">ë³€í™˜ ê¸°ë¡ í™•ì¸</h3>
                    <p>ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>`;

                try {
 
                    const response = await fetch('http://localhost:3001/api/history', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                     
                   }
                    });
                    if (!response.ok) throw new Error('ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');

                    const records = await response.json();
                    let recordsHTML = `
                        
                        <h3 class="text-2xl font-bold mb-6 text-[var(--brand-green-dark)] text-center">ë³€í™˜ ê¸°ë¡ í™•ì¸</h3>`;
                    if (records.length === 0) {
                        recordsHTML += `
                            <div class="text-center text-gray-500 p-8 border border-gray-200 rounded-xl">
                                <i class="fas fa-list-ul text-4xl 
                                 mb-4 text-[var(--brand-green-light)]"></i>
                                <p>ì•„ì§ ë³€í™˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            </div>`;
                    } else {
                        recordsHTML += '<div class="space-y-3 max-h-[60vh] overflow-y-auto pr-2">';
                        records.forEach(record => {
                            // ëª¨ë¸ ì´ë¦„ì´ ì—†ê±°ë‚˜ ì‚­ì œëœ ê²½ìš° 'ì•Œ ìˆ˜ ì—†ìŒ'ìœ¼ë¡œ í‘œì‹œ
                            const modelName = record.modelName || 'ê¸°ë³¸ ëª¨ë¸';

                           
                             recordsHTML += `
                                <div class="p-4 bg-white rounded-lg shadow-sm" id="history-item-${record.id}">
                                    <div class="flex justify-between items-center mb-2">
                    
                                     <p class="text-sm text-gray-500">${new Date(record.createdAt).toLocaleString()}</p>
                                        <div class="flex items-center gap-2">
                                  
                                             <span class="text-xs font-semibold bg-green-100 text-green-800 px-2 py-1 rounded-full">${modelName}</span>
                                            
                                       
                                             <button class="delete-history-btn text-gray-400 hover:text-red-500 transition-colors" data-record-id="${record.id}">
                                                <i class="fas fa-trash-alt"></i>
                                        
                                             </button>
                                            </div>
                                    </div>
                
                                     <p class="font-semibold truncate my-1" title="${record.text}">${record.text}</p>
                                    <audio controls src="${record.fileUrl}" class="w-full mt-2"></audio>
                                </div>`;
                        });
                        recordsHTML += '</div>';
                    }
                    historyContainer.innerHTML = recordsHTML;
                    document.querySelectorAll('.delete-history-btn').forEach(button => {
                        button.addEventListener('click', async (e) => {
                            const recordId = e.currentTarget.dataset.recordId;
                            
           
                                 if (!confirm('ì´ ê¸°ë¡ì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                return;
                            }

                  
                             const token = localStorage.getItem('token');
                            showLoading();

                            try {
                              
                                 const response = await fetch(`http://localhost:3001/api/history/${recordId}`, {
                                    method: 'DELETE',
                                    headers: { 'Authorization': `Bearer ${token}` }
               
                                 });

                                const result = await response.json();
                                hideLoading();
               
                                 showMessage(result.message);
                                if (response.ok) {
                                    // ì„±ê³µ ì‹œ í™”ë©´ì—ì„œ í•´ë‹¹ í•­ëª© ì¦‰ì‹œ ì œê±°
                                    document.getElementById(`history-item-${recordId}`).remove();
                                }
                            } catch (error) {
                                hideLoading();
                                showMessage('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                            }
                        });
                    });

                } catch (error) {
                    historyContainer.innerHTML = `<p>ì˜¤ë¥˜: ${error.message}</p>`;
                }
            });
            document.getElementById('settings-button').addEventListener('click', e => {
                e.preventDefault();
                showMypageSubSection('settings-section');
            });
            document.getElementById('mypage-back-button').addEventListener('click', e => { e.preventDefault(); showSection('main-app-section', 'flex'); });
            document.getElementById('change-info-back-button').addEventListener('click', e => { e.preventDefault(); showMypageSubSection('mypage-menu'); });
            document.getElementById('history-back-button').addEventListener('click', e => { e.preventDefault(); showMypageSubSection('mypage-menu'); });
            document.getElementById('settings-back-button').addEventListener('click', e => { e.preventDefault(); showMypageSubSection('mypage-menu'); });
            // --- Validation Functions ---
            const isValidEmail = (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            const isValidPassword = (password) => /^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]).{10,}$/.test(password);
            function calculateAge(dobStr){
                if(!dobStr) return null;
                const dob = new Date(dobStr); const today = new Date();
                let age = today.getFullYear() - dob.getFullYear();
                const m 
                 = today.getMonth() - dob.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) age--;
                return age;
            }

            // --- Tab key navigation fix for gender radio buttons ---
            const genderMaleRadio = document.querySelector('input[name="gender"][value="male"]');
   
                     const genderFemaleRadio = document.querySelector('input[name="gender"][value="female"]');
            genderMaleRadio.addEventListener('keydown', function(e) {
                if (e.key === 'Tab' && !e.shiftKey) {
                    e.preventDefault();
                    genderFemaleRadio.focus();
                }
            });
            genderFemaleRadio.addEventListener('keydown', function(e) {
                if (e.key === 'Tab' && e.shiftKey) {
                    e.preventDefault();
                    genderMaleRadio.focus();
                }
            });
            // --- Real-time validation for Sign-up ---
            const signupYear = document.getElementById('signup-year');
            const signupMonth = document.getElementById('signup-month');
            const signupDay = document.getElementById('signup-day');

            function handleDobInput(currentInput, nextInput, maxLength) {
                if (currentInput.value.length > maxLength) {
                    currentInput.value = currentInput.value.slice(0, maxLength);
                }
                if (currentInput.value.length === maxLength && nextInput) {
                    nextInput.focus();
                }
                updateAge();
            }

            signupYear.addEventListener('input', () => handleDobInput(signupYear, signupMonth, 4));
            signupMonth.addEventListener('input', () => handleDobInput(signupMonth, signupDay, 2));
            signupDay.addEventListener('input', () => handleDobInput(signupDay, null, 2));
            function updateAge() {
                const year = signupYear.value;
                const month = signupMonth.value;
                const day = signupDay.value;
                const calculatedAgeInput = document.getElementById('calculated-age');
                if (year.length === 4 && month.length > 0 && day.length > 0) {
                     const dobStr = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
                     calculatedAgeInput.value = calculateAge(dobStr) || '';
                } else {
                    calculatedAgeInput.value = '';
                }
            }
            
            const signupPassword = document.getElementById('signup-password');
            const signupPasswordConfirm = document.getElementById('signup-password-confirm');
            const passwordValidationError = document.getElementById('password-validation-error');
            const passwordMatchError = document.getElementById('password-match-error');
            signupPassword.addEventListener('input', () => {
                passwordValidationError.classList.toggle('text-green-600', isValidPassword(signupPassword.value));
                passwordValidationError.classList.toggle('text-red-600', !isValidPassword(signupPassword.value));
                passwordMatchError.classList.toggle('hidden', !signupPasswordConfirm.value || signupPassword.value === signupPasswordConfirm.value);
            });
            signupPasswordConfirm.addEventListener('input', () => {
                passwordMatchError.classList.toggle('hidden', signupPassword.value === signupPasswordConfirm.value);
            });
            // --- Real-time validation for My Page ---
            const newPassword = document.getElementById('new-password');
            const newPasswordConfirm = document.getElementById('new-password-confirm');
            const newPasswordValidationError = document.getElementById('new-password-validation-error');
            const newPasswordMatchError = document.getElementById('new-password-match-error');
            newPassword.addEventListener('input', () => {
                newPasswordValidationError.classList.toggle('text-green-600', isValidPassword(newPassword.value));
                newPasswordValidationError.classList.toggle('text-red-600', !isValidPassword(newPassword.value));
                newPasswordMatchError.classList.toggle('hidden', !newPasswordConfirm.value || newPassword.value === newPasswordConfirm.value);
            });
            newPasswordConfirm.addEventListener('input', () => {
                newPasswordMatchError.classList.toggle('hidden', newPassword.value === newPasswordConfirm.value);
            });
            // --- Form Handlers ---
            document.getElementById('login-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                if (!email || !password) return showMessage('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');

   
                             showLoading();

                try {
                    const response = await fetch('http://localhost:3001/api/login', {
                        method: 'POST',
                    
                         headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                 
                           email: email,
                            pw: password
                        })
                    });

               
                     const result = await response.json();
                    hideLoading();
                    if (!response.ok) {
                        throw new Error(result.message || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }

                    // ë¡œê·¸ì¸ ì„±ê³µ: ì„œë²„ë¡œë¶€í„° ë°›ì€ í† í°(JWT)ì„ ë¸Œë¼ìš°ì €ì— ì €ì¥í•©ë‹ˆë‹¤.
                    localStorage.setItem('token', result.token);
                    localStorage.setItem('loggedInUser', email); // ì•±ì˜ ë‹¤ë¥¸ ë¶€ë¶„ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì´ë©”ì¼ë„ ì €ì¥

                    showMessage('ë¡œê·¸ì¸ ì„±ê³µ!');
                    setTimeout(() => {
                        hideMessage();
                        showSection('main-app-section', 'flex');
                        showTab('tts-content');
                    }, 1000);
                } catch (error) {
                    hideLoading();
                    showMessage(error.message);
                }
            });
            document.getElementById('signup-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                const name = document.getElementById('signup-name').value;
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-password-confirm').value;
     
                const year = document.getElementById('signup-year').value;
                const month = document.getElementById('signup-month').value;
                const day = document.getElementById('signup-day').value;
                const age = document.getElementById('calculated-age').value;
                const gender = document.querySelector('input[name="gender"]:checked');
          
               
                // --- ìœ íš¨ì„± ê²€ì‚¬ (ê¸°ì¡´ê³¼ ë™ì¼) ---
                if (!name || !email || !year || !month || !day || !password || !confirmPassword ||
                    !gender) return showMessage('ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                if (!isValidEmail(email)) return showMessage('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                if (!isValidPassword(password)) return showMessage('ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•˜ì—¬ 10ìë¦¬ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                if (password !== confirmPassword) return showMessage('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                
                showLoading();
                try {
                    const response = await fetch('http://localhost:3001/api/register', {
                        method: 'POST',
                        headers: {
                        
                             'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            email: email,
                 
                             pw: password,
                            name: name,
                            age: age,
                            gender: gender.value
 
                        }),
                    });
                    const result = await response.json();
                    hideLoading();

                    if (!response.ok) {
                        // ì„œë²„ì—ì„œ ë³´ë‚¸ ì—ëŸ¬ ë©”ì‹œì§€ (ì˜ˆ: "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.")ë¥¼ í‘œì‹œ
                        throw new Error(result.message || `ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                    }
                    
                    // íšŒì›ê°€ì… ì„±ê³µ
                    showMessage('íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    showSection('login-section', 'flex');

                } catch (error) {
                    hideLoading();
                    showMessage(error.message);
                }
            });
            // --- My Page Form Handlers ---
            document.getElementById('send-code-button').addEventListener('click', () => {
                const loggedInUser = localStorage.getItem('loggedInUser');
                const currentEmail = document.getElementById('current-email').value;
                if (!currentEmail.trim()) return showMessage('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                if (currentEmail !== loggedInUser) return 
                    showMessage('ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ ì´ë©”ì¼ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');

                showMessage('ì¸ì¦ì½”ë“œê°€ ì´ë©”ì¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤: 123456');
                document.getElementById('reset-password-step').disabled = false;
                const changeBtn = document.getElementById('change-password-button');
                changeBtn.disabled = false;
                changeBtn.classList.remove('bg-gray-300');
      
                   changeBtn.classList.add('bg-[var(--brand-green-dark)]', 'hover:bg-[var(--brand-green-hover)]');
            });
            document.getElementById('password-reset-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const code = document.getElementById('verification-code').value;
                const newPass = document.getElementById('new-password').value;
                const newPassConfirm = document.getElementById('new-password-confirm').value;

                if (code !== '123456') return showMessage('ì¸ì¦ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
 
                 if (!isValidPassword(newPass)) return showMessage('ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n(ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì í¬í•¨ 10ìë¦¬ ì´ìƒ)');
                if (newPass !== newPassConfirm) return showMessage('ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');

                showLoading();
                setTimeout(() => {
                
                     const loggedInUser = localStorage.getItem('loggedInUser');
                    const users = JSON.parse(localStorage.getItem('users')) || {};
                    if (users[loggedInUser]) {
                        users[loggedInUser].password = newPass;
                        localStorage.setItem('users', JSON.stringify(users));
                        hideLoading();
                        showMessage('ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        setTimeout(() => {
                            hideMessage();
                            showSection('main-app-section', 'flex');
                        }, 1500);
                    } else {
                        hideLoading();
                        showMessage('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                }, 500);
            });

            // --- Profile Picture Logic ---
            document.getElementById('profile-pic-container').addEventListener('click', () => {
                document.getElementById('profile-pic-input').click();
            });
            document.getElementById('profile-pic-input').addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
             
                         const imageSrc = e.target.result;
                        document.getElementById('profile-image').src = imageSrc;
                        document.getElementById('header-profile-image').src = imageSrc;
                    }
              
                     reader.readAsDataURL(file);
                }
            });
            // --- Gemini TTS API ---
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
            function base64ToArrayBuffer(base64) {
                const binaryString = window.atob(base64);
                const len = binaryString.length; const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) { bytes[i] = binaryString.charCodeAt(i);
                } return bytes.buffer;
            }
            function pcmToWav(pcmData, sampleRate) {
                const numChannels = 1, bytesPerSample = 2;
                const blockAlign = numChannels * bytesPerSample;
                const byteRate = sampleRate * blockAlign; const dataSize = pcmData.length * bytesPerSample;
                const buffer = new ArrayBuffer(44 + dataSize); const view = new DataView(buffer);
                view.setUint32(0, 0x52494646, false); view.setUint32(4, 36 + dataSize, true);
                view.setUint32(8, 0x57415645, false);
                view.setUint32(12, 0x666d7420, false); view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, numChannels, true);
                view.setUint32(24, sampleRate, true);
                view.setUint32(28, byteRate, true); view.setUint16(32, blockAlign, true); view.setUint16(34, 16, true);
                view.setUint32(36, 0x64617461, false); view.setUint32(40, dataSize, true);
                for (let i = 0; i < pcmData.length; i++) { view.setInt16(44 + i * 2, pcmData[i], true);
                }
                return new Blob([view], { type: 'audio/wav' });
            }
            document.getElementById('tts-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                const text = document.getElementById('tts-text').value; 
                const modelId = document.getElementById('selected-voice').value;
                const token = localStorage.getItem('token'); // ë¡œê·¸ì¸ ì‹œ ì €ì¥í•œ í† í° ê°€ì ¸ì˜¤ê¸°

     
                         if (!text.trim()) {
                    return showMessage('ë³€í™˜í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
                if (!token) {
                    return showMessage('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
      
                   }

                showLoading();
                
                try {
                    const response = await fetch('http://localhost:3001/api/convert', {
                
                         method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}` // ì¸ì¦ í† í° í—¤ë”ì— ì¶”ê°€
  
                         },
                        body: JSON.stringify({
                            text: text,
                        
                             modelId: modelId
                        })
                    });
                    const result = await response.json();
                    hideLoading();

                    if (!response.ok) {
                        throw new Error(result.message || 'ìŒì„± ë³€í™˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                    
                    // ì„±ê³µ: ê²°ê³¼ ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ì— URL ì—°ê²°
                    const ttsAudioEl = document.getElementById('tts-audio');
                    ttsAudioEl.src = result.url;
                    
                    document.getElementById('tts-result').classList.remove('hidden');
                    
                    // --- â¬‡ï¸ ìˆ˜ì •ëœ ë¶€ë¶„ ---
                    document.getElementById('download-container').style.display = 'block';
                    document.getElementById('share-button').classList.remove('hidden');
                    // --- â¬†ï¸ ì—¬ê¸°ê¹Œì§€ ---

                    console.log("ìŒì„± ë³€í™˜ ì„±ê³µ! URL:", result.url);

                } catch (error) {
                    hideLoading();
                    showMessage(error.message);
                    console.error("TTS ë³€í™˜ ì‹¤íŒ¨:", error);
                }
            });
            
            // ========================= [ê³µìœ í•˜ê¸°] ì´ë©”ì¼ ì „ì†¡ ë¡œì§ ì‹œì‘ =========================
            emailModalForm.addEventListener('submit', function(e) {
              e.preventDefault();
              const recipientEmail = emailModalInput.value;
              if (!isValidEmail(recipientEmail)) return showMessage('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');

              const text = document.getElementById('tts-text').value;
              const subject = encodeURIComponent('ì•„ë³´ì¹´ë„ ìŒì„± ë³€í™˜ ê²°ê³¼');
              const audioUrl = document.getElementById('tts-audio').src;
              const body = encodeURIComponent(
                `ì•ˆë…•í•˜ì„¸ìš”. ì•„ë³´ì¹´ë„ì—ì„œ ìƒì„±í•œ ìŒì„±ì…ë‹ˆë‹¤.\n\n[ë³€í™˜ í…ìŠ¤íŠ¸]\n${text}\n\n[ìŒì„± íŒŒì¼ ë“£ê¸°]\n${audioUrl}\n\nê°ì‚¬í•©ë‹ˆë‹¤.`
              );

              window.location.href = `mailto:${recipientEmail}?subject=${subject}&body=${body}`;
              emailModal.style.display = 'none';
            });
            emailModalCancel.addEventListener('click', () => { emailModal.style.display = 'none'; });// ========================= [ê³µìœ í•˜ê¸°] ì´ë©”ì¼ ì „ì†¡ ë¡œì§ ë =========================
            
            // --- ì»¤ìŠ¤í…€ ìŒì„± ëª¨ë¸ ê´€ë ¨ ê¸°ëŠ¥ ---

            // íŒŒì¼ ì„ íƒ ì‹œ íŒŒì¼ëª… í‘œì‹œ
            document.getElementById('voice-file-input').addEventListener('change', (e) => {
                const file = e.target.files[0];
                const fileNameDisplay = document.getElementById('file-name-display');
               
                 
                if (file) {
                    fileNameDisplay.textContent = `ì„ íƒëœ íŒŒì¼: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                    fileNameDisplay.classList.remove('hidden');
                } else {
             
                     fileNameDisplay.classList.add('hidden');
                }
            });
            // ë‚´ ëª¨ë¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            async function loadMyModels() {
                const token = localStorage.getItem('token');
                if (!token) return;

                try {
                    const response = await fetch('http://localhost:3001/api/models/my-models', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                
                         }
                    });
                    if (!response.ok) {
                        if (response.status === 419 || response.status === 401) {
                            localStorage.removeItem('token');
                            localStorage.removeItem('loggedInUser');
                            showMessage('ë¡œê·¸ì¸ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                            return;
                        }
                        throw new Error('ëª¨ë¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                    }

                    const data = await response.json();
                    const { models, count, maxCount } = data;

                    // ëª¨ë¸ ê°œìˆ˜ ì—…ë°ì´íŠ¸
                    document.getElementById('model-count-badge').textContent = `${count} / ${maxCount}`;
                    // ëª¨ë¸ ëª©ë¡ ë Œë”ë§
                    const modelsList = document.getElementById('my-models-list');
                    modelsList.innerHTML = '';

                    if (count === 0) {
                        modelsList.innerHTML = `
                            <div class="text-center text-gray-500 p-6 border border-gray-200 rounded-xl">
                                <i 
                                 class="fas fa-microphone-slash text-4xl mb-3 text-gray-300"></i>
                                <p>ì•„ì§ ìƒì„±ëœ ì»¤ìŠ¤í…€ ëª¨ë¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            </div>`;
                    } else {
                        models.forEach(model => {
                            const modelCard = document.createElement('div');
                            modelCard.className = 'flex items-center justify-between p-4 bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow';
   
                                                     modelCard.innerHTML = `
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 
                                     h-10 rounded-full bg-[var(--brand-green-light)] bg-opacity-20 flex items-center justify-center">
                                        <i class="fas fa-user text-[var(--brand-green-dark)]"></i>
                                    </div>
               
                                     <div>
                                        <p class="font-semibold text-gray-800">${model.name}</p>
                                     
                                         <p class="text-xs text-gray-500">${new Date(model.createdAt).toLocaleDateString()}</p>
                                    </div>
                                </div>
                          
                                 <button 
                                    class="delete-model-btn text-red-500 hover:text-red-700 transition-colors" 
                                    data-model-id="${model.id}"
                 
                                     data-model-name="${model.name}"
                                >
                                    <i class="fas fa-trash-alt text-lg"></i>
          
                                 </button>
                            `;
                            modelsList.appendChild(modelCard);
                        });

                         // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                        document.querySelectorAll('.delete-model-btn').forEach(btn => {
                            btn.addEventListener('click', async (e) => {
                                const modelId = e.currentTarget.dataset.modelId;
                                const modelName = e.currentTarget.dataset.modelName;
                                
                                if (!confirm(`"${modelName}" ëª¨ë¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

                                showLoading();
                                try {
                                    const deleteResponse = await fetch(`http://localhost:3001/api/models/custom/${modelId}`, {
                                        method: 'DELETE',
                                        headers: {
                                            'Authorization': `Bearer ${token}`
                                        }
                                    });

                                    if (!deleteResponse.ok) throw new Error('ëª¨ë¸ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');

                                    hideLoading();
                                    showMessage('ëª¨ë¸ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                                    loadMyModels(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                                    populateVoices(); // TTS íƒ­ì˜ ëª¨ë¸ ëª©ë¡ë„ ìƒˆë¡œê³ ì¹¨
                                } catch (error) {
                                    hideLoading();
                                    showMessage(error.message);
                                }
                            });
                        });
                    }

                    // ìƒì„± í¼ í‘œì‹œ/ìˆ¨ê¹€
                    if (count >= maxCount) {
                        document.getElementById('create-model-form').classList.add('hidden');
                        document.getElementById('model-limit-message').classList.remove('hidden');
                    } else {
                        document.getElementById('create-model-form').classList.remove('hidden');
                        document.getElementById('model-limit-message').classList.add('hidden');
                    }

                } catch (error) {
                    console.error('ëª¨ë¸ ë¡œë“œ ì˜¤ë¥˜:', error);
                }
            }

            // ì»¤ìŠ¤í…€ ìŒì„± ì—…ë¡œë“œ í¼ ì œì¶œ
            document.getElementById('custom-voice-upload-form').addEventListener('submit', async (e) => {
                e.preventDefault();

                const modelName = document.getElementById('model-name-input').value.trim();
                const fileInput = document.getElementById('voice-file-input');
 
                 const file = fileInput.files[0];
                const token = localStorage.getItem('token');

                if (!token) {
                    return showMessage('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                }

       
                 if (!modelName) {
                    return showMessage('ëª¨ë¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }

                if (!file) {
                    return showMessage('ìŒì„± íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
         
                       }

                if (file.size > 50 * 1024 * 1024) {
                    return showMessage('íŒŒì¼ í¬ê¸°ëŠ” 50MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                }

                const formData = new FormData();
                formData.append('voiceSample', file);
                formData.append('modelName', modelName);

                showLoading();

                try {
                    const response = await fetch('http://localhost:3001/api/models/custom', {
                        method: 'POST',
                        headers: {
                   
                             'Authorization': `Bearer ${token}`
                        },
                        body: formData
                    });
                    const result = await response.json();
                    hideLoading();

                    if (!response.ok) {
                        throw new Error(result.message || 'ëª¨ë¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }

                    showMessage('ì»¤ìŠ¤í…€ ëª¨ë¸ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰');
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('model-name-input').value = '';
                    fileInput.value = '';
                    document.getElementById('file-name-display').classList.add('hidden');

                    // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    loadMyModels();
                } catch (error) {
                    hideLoading();
                    showMessage(error.message);
                    console.error('ëª¨ë¸ ìƒì„± ì˜¤ë¥˜:', error);
                }
            });
            // My Voice íƒ­ í´ë¦­ ì‹œ ëª¨ë¸ ëª©ë¡ ë¡œë“œ
            document.getElementById('my-voice-tab').addEventListener('click', () => {
                showTab('my-voice-content');
                loadMyModels();
            });
        });
    </script>
</body>
</html>